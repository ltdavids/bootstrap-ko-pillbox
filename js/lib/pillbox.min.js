/*!
 * bootstrap-ko-pillbox v0.0.1 for Bootstrap 3
 * Copyright 2015 Leo Davidson
 * Licensed under http://opensource.org/licenses/MIT
 *
 * https://github.com/ltdavids/bootstrap-ko-pillbox
 */
/*! https://mths.be/startswith v0.2.0 by @mathias */
String.prototype.startsWith||function(){"use strict";var n=function(){try{var n={},t=Object.defineProperty,i=t(n,n,n)&&t}catch(r){}return i}(),i={}.toString,t=function(n){var u,f,r;if(this==null)throw TypeError();if(u=String(this),n&&i.call(n)=="[object RegExp]")throw TypeError();var e=u.length,o=String(n),s=o.length,h=arguments.length>1?arguments[1]:undefined,t=h?Number(h):0;if(t!=t&&(t=0),f=Math.min(Math.max(t,0),e),s+f>e)return!1;for(r=-1;++r<s;)if(u.charCodeAt(f+r)!=o.charCodeAt(r))return!1;return!0};n?n(String.prototype,"startsWith",{value:t,configurable:!0,writable:!0}):String.prototype.startsWith=t}();define(["knockout","jquery"],function(n,t){function r(r,u){function o(n){n||(n=window.event);n.stopPropagation?n.stopPropagation():n.cancelBubble=!0}function h(n){if(n.value.length==0)return 0;if(n.selectionStart)return n.selectionStart;if(!document.selection)return 0;var i="\001",t=document.selection.createRange(),r=t.duplicate(),u=0;return r.moveToElementText(n),t.text=i,u=r.text.indexOf(i),t.moveStart("character",-1),t.text="",u}function w(r,u){function l(n){var u,c,r,s,l,o;if(console.debug("handleInputKeyDown"),f.cancelKey=!1,n.keyCode==40)return f.inKeyBoardMode=!0,f.highlightNextItem(),!1;if(n.keyCode==38)return f.highlightPrevItem(),f.cancelKey=!0,!1;if(n.keyCode==34)return!1;if(u=window.shiftKey?256:0,c=v[u+n.keyCode],f.caret(h(n.target)),r=f.caret(),f.options().length==1)if(n.which==13||n.which==9)f.clearAll(),f.selectItem(f.options()[0]),f.cancelKey=!0;else{if(n.which==27)return f.clearAll(),e();if(n.which==8){if(s=t(f.input).val().substring(0,r-1).toUpperCase(),!s)return f.clearAll(),!1;s===f.searchText().substring(0,r-1).toUpperCase()&&(f.cancelKey=!0,t(f.input).selectRange(r-1),f.caret(r-1))}else 24<=n.which&&n.which<=222&&(l=t(f.input).val().substring(r,r+1).toUpperCase(),o=c,u+n.which>=65&&u+n.which<=90&&(o=o.toUpperCase()),o===l&&(t(f.input).selectRange(r+1),f.cancelKey=!0))}else{if(n.which==27){f.clearAll();e();return}if(n.which==9||n.which==13){t.each(f.options(),function(n,t){if(t.highlight())return f.selectItem(t),!1});f.clearAll();e();return}if(n.which==32&&f.inKeyBoardMode)for(i=0;i<f.options().length;i++)if(f.options()[i].highlight()){f.selectItem(f.options()[i]);f.cancelKey=!0;break}}if(f.cancelKey)return!1}function a(){if(f.cancelKey)return!1}function y(n){if(f.suppressKeyUp)f.suppressKeyUp=!1;else{var t=h(n.target);f.caret(t);f.filter()}}function c(){if(!f.element.find(".pillbox").hasClass("open"))return f.toggle.trigger("focus"),f.toggle.trigger("click")}function e(){if(f.element.find(".pillbox").hasClass("open"))return f.toggle.trigger("focus"),f.toggle.trigger("click")}function s(n){if(console.debug("onBodyKeyDown"),f.cancelKey=!1,n.keyCode==40)return c(),f.inKeyBoardMode=!0,f.highlightNextItem(),!1;if(n.keyCode==38)return f.highlightPrevItem(),f.cancelKey=!0,!1;if(n.which==32&&f.inKeyBoardMode){for(i=0;i<f.options().length;i++)if(f.options()[i].highlight()){f.selectItem(f.options()[i]);f.cancelKey=!0;break}}else n.which==27&&(f.clearAll(),e());n.which==9&&(f.clearAll(),e())}function w(){f.inFocus(!0);f.element.addClass("focus")}function b(){f.inFocus(!1);f.element.removeClass("focus");f.element.find(".dummy>input").show()}var f=this;f.element=u;f.toggle=f.element.find(".dropdown-toggle");f.cancelKey=!1;f.suppressKeyUp=!1;f.inKeyBoardMode=!1;f.input=f.element.find(".search>input")[0];f.showPillbox=n.observable(r.showPillbox!==undefined?r.showPillbox:!0);f.optionsText=r.optionsText!==undefined?r.optionsText:"";f.optionsPopOver=r.optionsPopOver!==undefined?r.optionsPopOver:"";f.selectedOptions=r.selectedOptions?r.selectedOptions:n.observableArray();f.caret=n.observable(0);f.inFocus=n.observable(!1);f.selStart=-1;f.inputEnabled=r.typeAhead!==undefined?r.typeAhead:!1;f.showSelected=r.showSelected!==undefined?r.showSelected:!1;f.scrollbar=r.scrollbar!==undefined?r.scrollbar:!0;f.optionValues=r.optionValues;f.searchText=n.computed(function(){if(f.input)return t(f.input).val().substring(0,f.caret()).toUpperCase()});f.hintText=n.observable("");f.displayText=n.observable("");f.remainingOptions=n.observableArray(n.unwrap(r.optionValues).slice(0).map(function(t){return t.selected=n.observable(!1),t.highlight=n.observable(!1),t}));f.remainingOptions.sort(function(n,t){return n[f.optionsText]<t[f.optionsText]?-1:n[f.optionsText]>t[f.optionsText]?1:0});f.options=n.observableArray(n.unwrap(f.remainingOptions).slice(0));f.options.sort(function(n,t){return n[f.optionsText]<t[f.optionsText]?-1:n[f.optionsText]>t[f.optionsText]?1:0});f.filtering=!1;f.lastSingle="";f.rows=n.observable(r.rows);f.itemHeight=n.observable(12);f.dropdownRows=n.observable(r.dropdownRows);f.height=n.computed(function(){if(f.rows()){var n=f.element.find(".btn").height()+6,t=f.rows()*n;return t.toFixed(0)+"px"}});f.dropheight=n.computed(function(){if(f.dropdownRows())return f.dropdownRows()*f.itemHeight()+"px"});f.option=function(n,t){switch(n.toUpperCase()){case"ROWS":f.rows(parseInt(t));break;case"DROPDOWNROWS":f.dropdownRows(parseInt(t));break;case"PLACEHOLDER":f.placeHolder(t);break;case"TYPEAHEAD":f.typeAhead(t);break;case"SHOWSELECTED":f.showSelected=t;break;case"SHOWPILLBOX":f.showPillbox(t)}};f.sort=function(n){n.sort(function(n,t){return n[f.optionsText]<t[f.optionsText]?-1:n[f.optionsText]>t[f.optionsText]?1:0})};f.removeItem=function(n){n.selected(!1);f.selectedOptions.remove(n);f.showSelected||f.remainingOptions.push(n);f.clearAll()};f.placeHolder=n.observable(r.placeHolder?r.placeHolder:"Choose");f.placeHolderVisible=n.computed(function(){return f.selectedOptions().length==0||!f.showPillbox()});f.clearSelections=function(){for(var n=0;n<f.options().length;n++)f.options()[n].selected&&f.removeItem(f.options()[n])};f.selectItem=function(n){n.selected()||(n.selected(!0),f.showSelected||f.remainingOptions.remove(n),f.selectedOptions.push(n))};f.handleClick=function(n,t){n.selected()?f.removeItem(n,t):f.selectItem(n,t);f.clearAll();o(t)};f.searchText.subscribe(function(n){n.length==0&&(f.lastSingle="")});f.filter=function(){var n,i,r;if(!f.inputEnabled){f.options(f.remainingOptions());return}(n=f.remainingOptions(),f.filtering)||(i=f.searchText(),i&&(n=f.remainingOptions().filter(function(n){return n[f.optionsText].toUpperCase().startsWith(i.toUpperCase())}),n.length==1?(f.hintText(n[0][f.optionsText].substring(f.searchText().length)),f.lastSingle!==n[0]&&(f.lastSingle=n[0],f.filtering=!0,t(f.input).val(n[0][f.optionsText]),t(f.input).selectRange(i.length),f.filtering=!1)):f.lastSingle&&(r=0,f.lastSingle="",f.clearHintText()),f.sort(n)),f.sort(n),f.options(n))};f.clearHintText=function(){f.hintText("");var n=h(f.input),i=t(f.input).val().substring(0,n);t(f.input).val(i)};f.clearHighlights=function(){t.each(f.options(),function(n,t){t.highlight(!1)})};f.highlightNextItem=function(){var n=0;for(i=0;i<f.options().length;i++)if(f.options()[i].highlight()){f.options()[i].highlight(!1);n=i+1;break}n=n>f.options().length-1?0:n;f.options()[n].highlight(!0);f.scrollTo()};f.highlightPrevItem=function(){var n=f.options().length-1;for(i=f.options().length-1;i>=0;i--)if(f.options()[i].highlight()){f.options()[i].highlight(!1);n=i-1;break}n=n<0?f.options().length-1:n;f.options()[n].highlight(!0);f.scrollTo()};f.scrollTo=function(){window.setTimeout(function(){$e=f.element.find(".highlight");$c=f.element.find(".options");var n,o=$e.offset(),s=$c.offset(),t=$c.scrollTop(),i=s.top-t,r=o.top-t,u=r+$e.height(),e=i+$c.height();u>e?n=t+u-e:r<i&&(n=t+r-i);n!==undefined&&$c.animate({scrollTop:n},100)})};f.clearAll=function(){f.hintText("");t(f.input).val("");f.caret(0);f.filter()};f.clearPopovers=function(){};f.showPopOver=function(n,i){$e=t(i.target).closest("li");f.element.find(".options li").not($e).popover("hide");$e.popover("show");f.optionsPopOver};f.hoverItem=function(n,t){console.debug("hover "+t.type);f.clearHighlights();n.highlight(!0);f.showPopOver(n,t);o(t)};f.onMouseWheel=function(n){$c=f.element.find(".options");$e=$c.find("li:first-child");var i=$e.height(),r=i*$c.find("li").length,t=$c.scrollTop();return console.debug("deltaMode:"+n.originalEvent.deltaMode),console.debug("deltaY:"+n.originalEvent.deltaY),console.debug("wheelDeltaY:"+n.originalEvent.wheelDeltaY),t=n.originalEvent.deltaY<0?Math.max(t-i,0):Math.min(t+i,r-$c.height()),console.debug("scrolltop: "+t),$c.scrollTop(t),!1};f.selectAll=function(){t.each(f.options(),function(n,t){f.selectItem(t)})};f.deselectAll=function(){t.each(f.options(),function(n,t){f.removeItem(t)})};f.init=function(){if(f.element.data("pillbox",f),f.inputEnabled)f.element.find(".search>input").on("keydown",l).on("keypress",a).on("keyup",y).on("click",function(n){o(n)});f.optionsPopOver&&t.each(f.element.find(".options li"),function(i,r){var u=n.dataFor(r);t(r).popover({content:u[p]})});f.element.find(".dummy>input").on("focus",function(){w();t("body").off("keydown",s);t("body").on("keydown",s)}).on("blur",function(){b();t("body").off("keydown",s)});f.toggle.on("click",function(){f.element.find(".dummy>input").focus()});f.toggle.parent().on("hide.bs.dropdown",function(){var n=f.element.find(".pillbox");n.removeClass("dropup");f.clearAll();f.clearHighlights();f.inKeyBoardMode=!1;f.selStart=-1;f.element.find(".dummy>input").focus()});f.toggle.parent().on("shown.bs.dropdown",function(n){if(f.dropdownRows()){var i=t(f.element.find(".options li")[0]).outerHeight();f.itemHeight(i)}f.clearHighlights();$e=t(n.target);f.inputEnabled&&$e.find(".search>input")[0].focus()});f.toggle.parent().on("show.bs.dropdown",function(){var n;if(f.element.attr("disabled"))return!1;n=f.element.find(".pillbox");n.removeClass("dropup");var i=f.element.offset(),r=t(window).scrollTop(),u=f.element.find(".dropdown-menu").outerHeight(),e=i.top+f.element.outerHeight()+u,o=i.top-u;r+t(window).height()<e&&o>r&&n.addClass("dropup")});f.scrollbar||f.element.find(".options").addClass("no-scroll");f.element.find(".options").on("wheel",f.onMouseWheel)}}var v=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""," ","","","","","","","","","","","","","","","","0","1","2","3","4","5","6","7","8","9","","","","","","","","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","","","","","","0","1","2","3","4","5","6","7","8","9","*","+","","-",".","/","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",";","=",",","-",".","/","`","","","","","","","","","","","","","","","","","","","","","","","","","","","[","\\","]",'"',"","","","","","","","","","","","","","","","","","","","","","","","","",")","!","@","#","$","%","^","&","*","(","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",":","+","<","_",">","?","~","","","","","","","","","","","","","","","","","","","","","","","","","","","{","|","}",'"'],e,a,s,c,l;$elem=t(u.element);var f=r.optionTemplate,y=r.optionsText!==undefined?r.optionsText:"",p=r.optionsPopOver!==undefined?r.optionsPopOver:"";if($elem.find(".selected-options").prepend('<li class="placeholder" data-bind="visible:placeHolderVisible"><span  data-bind="text:placeHolder"><\/span><\/li>'),$elem.find(".selected-options").append('<li class="padder" >&nbsp;<span class="caret" data-bind="visible:placeHolderVisible"><\/span><\/li>'),$elem.find(".selected-options").append('<li class="dummy" ><input class="" type="text"  /><\/li>'),f){if(e="",typeof f=="function")e=f();else{if(a=t("#"+f)[0],!a)throw"Invalid template";e=t("#"+f)[0].innerHTML}$elem.find(".options>li").append(e)}else $elem.find(".options>li").append('<a><div data-bind="text:'+y+'"><\/div><\/a>');return(r.typeAhead!==undefined?r.typeAhead:!1)&&$elem.find(".dropdown-menu").prepend('<li class="search"><input class="form-control" type="text"  /><\/li>'),s=new w(r,$elem),c=u.templateNodes[0],c&&(l=t.trim(c.nodeValue),s.placeHolder(l?l:s.placeHolder())),$elem.data("pillbox",self),s}return t.fn.selectRange=function(n,t){return t||(t=n),this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(n,t);else if(this.createTextRange){var i=this.createTextRange();i.collapse(!0);i.moveEnd("character",t);i.moveStart("character",n);i.select()}})},{createViewModel:r}});
//# sourceMappingURL=pillbox.min.js.map
