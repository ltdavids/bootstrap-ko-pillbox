/*!
 * bootstrap-ko-pillbox v0.0.1 for Bootstrap 3
 * Copyright 2015 Leo Davidson
 * Licensed under http://opensource.org/licenses/MIT
 *
 * https://github.com/ltdavids/bootstrap-ko-pillbox
 */
/*! https://mths.be/startswith v0.2.0 by @mathias */
String.prototype.startsWith||function(){"use strict";var n=function(){try{var n={},t=Object.defineProperty,i=t(n,n,n)&&t}catch(r){}return i}(),i={}.toString,t=function(n){var u,f,r;if(this==null)throw TypeError();if(u=String(this),n&&i.call(n)=="[object RegExp]")throw TypeError();var e=u.length,o=String(n),s=o.length,h=arguments.length>1?arguments[1]:undefined,t=h?Number(h):0;if(t!=t&&(t=0),f=Math.min(Math.max(t,0),e),s+f>e)return!1;for(r=-1;++r<s;)if(u.charCodeAt(f+r)!=o.charCodeAt(r))return!1;return!0};n?n(String.prototype,"startsWith",{value:t,configurable:!0,writable:!0}):String.prototype.startsWith=t}();define(["knockout","jquery"],function(n,t){function r(r,u){function e(n){n||(n=window.event);n.stopPropagation?n.stopPropagation():n.cancelBubble=!0}function h(n){if(n.value.length==0)return 0;if(n.selectionStart)return n.selectionStart;if(!document.selection)return 0;var i="\001",t=document.selection.createRange(),r=t.duplicate(),u=0;return r.moveToElementText(n),t.text=i,u=r.text.indexOf(i),t.moveStart("character",-1),t.text="",u}function v(r,u,f){function v(){return s.element.attr("disabled")!==undefined}function b(){if(s.pillboxRows()&&s.selectedOptions().length>0){var n=s.element.find(".btn").height()+6,t=s.pillboxRows()*n;s.element.find(".selections").css("max-height",t.toFixed(0)+"px")}else s.element.find(".selections").css("max-height","")}function k(){s.dropdownRows()?s.element.find(".options").css("max-height",s.dropdownRows()*s.itemHeight()-4+"px"):s.element.find(".options").css("max-height","")}function ot(){window.setTimeout(function(){s.showPillbox()&&s.multiple()?(s.element.find("li.selected-option").show(),b()):(s.element.find(".selected-options").css("visibility","visible"),s.element.find("li.selected-option").hide())},0)}function d(){var n=s.placeHolder()?s.placeHolder():"Choose";s.multiple()?s.placeHolder()&&s.element.find(".selected-options li.placeholder").text(s.placeHolder()?s.placeHolder():"Choose"):s.element.find(".selected-options li.placeholder").text(s.selectedOptions().length>0?s.selectedOptions()[0][o]:n)}function y(){d();ot();s.selectedOptions().length!=0&&s.showPillbox()?s.multiple()&&(s.element.find(".selected-options li.placeholder").hide(),s.element.find(".selected-options li.padder .caret").hide()):(s.element.find(".selected-options li.placeholder").show(),s.element.find(".selected-options li.padder .caret").show());return}function g(){if($items=s.element.find(".options li"),$items.popover("hide"),s.popover()){var n=t(window).width()>400?"right auto":"bottom auto";$items.popover({html:!0,placement:n,content:s.popoverContent()})}}function nt(t,i){if(!v()){var t=t?t:n.dataFor(i.target);t.selected(!1);s.selectedOptions.remove(t);s.showSelected||s.remainingOptions.push(t);s.clearAll()}e(i)}function c(n){n.selected()||(s.multiple()||(s.clearSelections(),s.element.find(".selected-options").css("visibility","hidden")),n.selected(!0),s.showSelected||s.availableOptions.remove(n),s.selectedOptions.push(n),s.autoClose()&&!s.multiple()&&l())}function st(t){var i=i?i:n.dataFor(t.target);nt(i,t)}function ht(){s.hintText("");var n=h(s.input),i=t(s.input).val().substring(0,n);t(s.input).val(i)}function p(){t.each(s.availableOptions(),function(n,t){t.highlight(!1)})}function tt(n){var u,o,r,e,v,f;if(s.cancelKey=!1,n.keyCode==40)return s.inKeyBoardMode=!0,s.highlightNextItem(),!1;if(n.keyCode==38)return s.highlightPrevItem(),s.cancelKey=!0,!1;if(n.keyCode==34)return!1;if(u=window.shiftKey?256:0,o=a[u+n.keyCode],s.caret(h(n.target)),r=s.caret(),s.hasSearchResults())if(n.which==13||n.which==9)c(s.availableOptions()[0]),s.clearAll(),s.cancelKey=!0;else{if(n.which==27)return s.clearAll(),l();if(n.which==8){if(e=t(s.input).val().substring(0,r-1).toUpperCase(),!e)return s.clearAll(),!1;e===s.searchText().substring(0,r-1).toUpperCase()&&(s.cancelKey=!0,t(s.input).selectRange(r-1),s.caret(r-1))}else 24<=n.which&&n.which<=222&&(v=t(s.input).val().substring(r,r+1).toUpperCase(),f=o,u+n.which>=65&&u+n.which<=90&&(f=f.toUpperCase()),f===v&&(t(s.input).selectRange(r+1),s.cancelKey=!0))}else{if(n.which==27){s.clearAll();l();return}if(n.which==9||n.which==13){t.each(s.availableOptions(),function(n,t){if(t.highlight())return c(t),!1});s.clearAll();l();return}if(n.which==32&&s.inKeyBoardMode)for(i=0;i<s.availableOptions().length;i++)if(s.availableOptions()[i].highlight()){c(s.availableOptions()[i]);s.cancelKey=!0;break}}if(s.cancelKey)return!1}function it(){if(s.cancelKey)return!1}function rt(n){if(s.suppressKeyUp)s.suppressKeyUp=!1;else{var t=h(n.target);s.caret(t);s.filter()}}function ut(){if(!s.pillbox.hasClass("open"))return s.toggle.trigger("focus"),s.toggle.trigger("click")}function l(){if(s.pillbox.hasClass("open"))return s.toggle.trigger("focus"),s.toggle.trigger("click")}function w(n){if(s.cancelKey=!1,n.keyCode==40)return ut(),s.inKeyBoardMode=!0,s.highlightNextItem(),!1;if(n.keyCode==38)return s.highlightPrevItem(),s.cancelKey=!0,!1;if(n.which==32&&s.inKeyBoardMode){for(i=0;i<s.availableOptions().length;i++)if(s.availableOptions()[i].highlight()){c(s.availableOptions()[i]);s.cancelKey=!0;break}}else n.which==27&&(s.clearAll(),l());n.which==9&&(s.clearAll(),l())}function ct(){s.element.addClass("focus");s.element.find(".selections").addClass("focus")}function lt(){s.element.removeClass("focus");s.element.find(".selections").removeClass("focus");s.element.find(".dummy>input").show()}function ft(i,r){if(!s.popover())return!1;if($e=t(r.target).closest("li"),!($e.next("div.popover").length>0)){s.element.find(".options li").not($e).popover("hide");$e.popover("show");var u=$e.next("div.popover")[0];n.dataFor(u)===i&&n.cleanNode(u);n.dataFor(u)===i||n.applyBindings(i,$e.next()[0]);s.optionsPopOver}}function at(t){var i=n.dataFor(t.target);p();i.highlight(!0);ft(i,t);e(t)}function et(n){var r,u,f,e,i;if($e=t(n.target),$p=$e.parents(".options"),$p=$p.length>0?$p:$e.parents(".selections"),$p=$p.length>0?$p:$e,r=$p.hasClass("options"),(s.dropdownRows()||!r)&&(s.pillboxRows()||r))return t(n.target).closest(".popover").length>0?!1:(u=r?s.optionTemplate?30:20:10,!r)?(f=s.element.find(".btn").height()+6,$p.scrollTop($p.scrollTop()+(n.originalEvent.deltaY>0?f:f*-1)),!1):($c=s.element.find(".options"),e=0,i=0,t(".options>li").each(function(n,i){e+=t(i).outerHeight()}),n.originalEvent.deltaY<0?(i=$c.scrollTop()-u,i=Math.max(i,0)):(i=$c.scrollTop()+u,i=Math.min(i,e-$c.height())),$c.scrollTop(i),!1)}var s=this;return s.id=u[0].id,s.element=u,s.toggle=s.element.find(".dropdown-toggle"),s.typeAhead=n.observable(),s.cancelKey=!1,s.suppressKeyUp=!1,s.inKeyBoardMode=!1,s.pillbox=s.element.find(".pillbox"),s.typeAhead(r.typeAhead!==undefined?r.typeAhead:!1),s.optionTemplate=r.optionTemplate,s.placeHolder=n.observable(),s.dropdownRows=n.observable(),s.showPillbox=n.observable(),s.pillboxRows=n.observable(),s.multiple=n.observable(),s.autoClose=n.observable(),s.optionsText=r.optionsText!==undefined?r.optionsText:"",s.popover=n.observable(r.popover!==undefined?r.popover:""),s.selectedOptions=r.selectedOptions?r.selectedOptions:n.observableArray(),s.remainingOptions=n.observableArray(),s.availableOptions=n.observableArray(),s.caret=n.observable(0),s.showSelected=n.observable(0),s.selStart=-1,s.showSelected=r.showSelected!==undefined?r.showSelected:!1,s.scrollbar=n.observable(),s.scrollbar.subscribe(function(){s.scrollbar()?(s.element.find(".options").addClass("no-scroll"),s.element.find(".selections").addClass("no-scroll")):(s.element.find(".options").removeClass("no-scroll"),s.element.find(".selections").removeClass("no-scroll"))}),s.optionValues=n.isObservable(r.optionValues)?r.optionValues:n.observableArray(r.optionValues),s.searchText=function(){if(s.input)return t(s.input).val().substring(0,s.caret()).toUpperCase()},s.hintText=n.observable(""),s.displayText=n.observable(""),s.filtering=!1,s.lastSingle="",s.itemHeight=n.observable(12),s.hasSearchResults=function(){return s.availableOptions().length<s.remainingOptions().length&&s.availableOptions().length>0},s.placeHolderVisible=n.computed(function(){return s.selectedOptions().length==0||!s.showPillbox()&&s.multiple()}),s.placeHolder.subscribe(d),s.selectedOptions.subscribe(y),s.showPillbox.subscribe(y),s.itemHeight.subscribe(k),s.pillboxRows.subscribe(b),s.dropdownRows.subscribe(k),s.optionValues.subscribe(function(){var i,r;s.availableOptions.removeAll();i=n.unwrap(s.optionValues).slice(0);t.each(i,function(t,i){i.selected=n.observable(!1);i.highlight=n.observable(!1)});s.remainingOptions(i);r=n.unwrap(s.selectedOptions).slice(0);s.selectedOptions.removeAll();s.filter();t.each(r,function(n,t){var i=s.remainingOptions().filter(function(n){return n[o]===t[o]})[0];c(t)})}),s.popoverContent=function(){var n,i;if(s.popover()&&s.popover().template)if(n="",typeof s.popover().template=="function")n=s.popover().template();else{if(i=t("#"+s.popover().template)[0],!i)throw"Invalid template";n=t("#"+s.popover().template)[0].innerHTML}return n},s.option=function(n,t){switch(n.toUpperCase()){case"PILLBOXROWS":s.pillboxRows(parseInt(t));break;case"DROPDOWNROWS":s.dropdownRows(parseInt(t));break;case"PLACEHOLDER":return t!==undefined&&s.placeHolder(t),s.placeHolder();case"TYPEAHEAD":return t!==undefined&&s.typeAhead(t),s.typeAhead();case"SCROLLBAR":return t!==undefined&&s.scrollbar(t),s.scrollbar();case"SHOWSELECTED":return t!==undefined&&(s.showSelected=t,s.filter()),s.showSelected;case"SHOWPILLBOX":return t!==undefined&&s.showPillbox(t),s.showPillbox();case"MULTIPLE":return t!==undefined&&(s.multiple(t),s.clearSelections(),y()),s.multiple();case"AUTOCLOSE":return t!==undefined&&s.autoClose(t),s.autoClose();case"DISABLED":return t!==undefined&&(t?(s.element.attr("disabled","disabled"),s.element.find(".dummy>input").hide()):t===!1&&(s.element.removeAttr("disabled"),s.element.find(".dummy>input").show())),v();case"POPOVER":t?(s.popover(t),s.element.find(".options li").popover({html:!0,placement:"right auto",content:s.popoverContent()})):(s.element.find(".options li").popover("destroy"),s.popover(t))}},s.typeAhead.subscribe(function(n){if(n&&!(s.element.find(".dropdown-menu").find(".search").length>0)){s.element.find(".dropdown-menu").prepend('<li class="search"><input class="form-control" type="text"  /><\/li>');s.input=s.element.find(".search>input")[0];s.element.find(".search>input").on("keydown",tt).on("keypress",it).on("keyup",rt).on("click",function(n){e(n)})}}),s.sort=function(n){n.sort(function(n,t){return n[s.optionsText]<t[s.optionsText]?-1:n[s.optionsText]>t[s.optionsText]?1:0})},s.onOptionClick=function(t){var i=n.dataFor(t.target);ft(i,t);i.selected()?nt(i,t):c(i,t);e(t)},s.filter=function(){var n,i,r;if(!s.typeAhead()){s.availableOptions(s.remainingOptions());s.availableOptions.valueHasMutated();s.availableOptions.notifySubscribers();return}(n=s.remainingOptions(),s.filtering)||(i=s.searchText(),i&&(n=s.remainingOptions().filter(function(n){return n[s.optionsText].toUpperCase().startsWith(i.toUpperCase())}),n.length<s.remainingOptions().length&&n.length>0?(s.hintText(n[0][s.optionsText].substring(s.searchText().length)),s.lastSingle!==n[0]&&(s.lastSingle=n[0],s.filtering=!0,t(s.input).val(n[0][s.optionsText]),t(s.input).selectRange(i.length),s.filtering=!1)):s.lastSingle&&(r=0,s.lastSingle="",ht())),s.sort(n),s.availableOptions(n),s.availableOptions.valueHasMutated(),s.availableOptions.notifySubscribers(),g())},s.clearSelections=function(){s.availableOptions.removeAll();var i=n.unwrap(s.optionValues).slice(0);t.each(i,function(t,i){i.selected=n.observable(!1);i.highlight=n.observable(!1)});s.remainingOptions(i);s.remainingOptions.sort(function(n,t){return n[s.optionsText]<t[s.optionsText]?-1:n[s.optionsText]>t[s.optionsText]?1:0});s.selectedOptions.removeAll();s.filter()},s.clearSelections(),s.highlightNextItem=function(){var n=0;for(i=0;i<s.availableOptions().length;i++)if(s.availableOptions()[i].highlight()){s.availableOptions()[i].highlight(!1);n=i+1;break}n=n>s.availableOptions().length-1?0:n;s.availableOptions()[n].highlight(!0);s.scrollTo()},s.highlightPrevItem=function(){var n=s.availableOptions().length-1;for(i=s.availableOptions().length-1;i>=0;i--)if(s.availableOptions()[i].highlight()){s.availableOptions()[i].highlight(!1);n=i-1;break}n=n<0?s.availableOptions().length-1:n;s.availableOptions()[n].highlight(!0);s.scrollTo()},s.scrollTo=function(){window.setTimeout(function(){$e=s.element.find(".highlight");$c=s.element.find(".options");var n,e=$e.offset(),o=$c.offset(),t=$c.scrollTop(),i=o.top-t,r=e.top-t,u=r+$e.height(),f=i+$c.height();u>f?n=t+u-f:r<i&&(n=t+r-i);n!==undefined&&$c.animate({scrollTop:n},100)})},s.clearAll=function(){s.hintText("");t(s.input).val("");s.caret(0);s.filter()},s.selectAll=function(){for(i=s.availableOptions().length-1;i>=0;i--)c(s.availableOptions()[i])},s.deselectAll=function(){s.clearSelections()},s.init=function(){var n,i;if(s.element.data("pillbox",s),s.pillboxRows(r.pillboxRows),s.placeHolder(r.placeHolder?r.placeHolder:"Choose"),n=f.templateNodes[0],n&&(i=t.trim(n.nodeValue),s.placeHolder(i?i:s.placeHolder())),s.dropdownRows(r.dropdownRows),s.scrollbar(r.scrollbar!==undefined?r.scrollbar:!1),s.multiple(r.multiple!==undefined?r.multiple:!1),s.autoClose(r.autoClose!==undefined?r.autoClose:!1),s.showPillbox(r.showPillbox!==undefined?r.showPillbox:!0),s.typeAhead()){s.element.find(".dropdown-menu").prepend('<li class="search"><input class="form-control" type="text"  /><\/li>');s.input=s.element.find(".search>input")[0];s.element.find(".search>input").on("keydown",tt).on("keypress",it).on("keyup",rt).on("click",function(n){e(n)})}g();s.element.find(".dummy>input").on("focus",function(){ct();t("body").off("keydown",w);t("body").on("keydown",w)}).on("blur",function(){lt();t("body").off("keydown",w)});s.toggle.on("click",function(){s.element.find(".dummy>input").focus()});s.toggle.parent().on("hide.bs.dropdown",function(){s.element.find(".options li").popover("hide");s.pillbox.removeClass("dropup");s.clearAll();p();s.inKeyBoardMode=!1;s.selStart=-1;s.element.find(".dummy>input").focus()});s.toggle.parent().on("shown.bs.dropdown",function(n){var i=t(s.element.find(".options li")[0]).outerHeight();s.itemHeight(i);s.dropdownRows()&&(s.itemHeight.valueHasMutated(),s.itemHeight.notifySubscribers());p();$e=t(n.target);s.typeAhead()&&$e.find(".search>input")[0].focus()});s.toggle.parent().on("show.bs.dropdown",function(){if(v())return!1;s.element.find(".options").scrollTop(0);s.pillbox.removeClass("dropup");var n=s.element.offset(),i=t(window).scrollTop(),r=s.element.find(".dropdown-menu").outerHeight(),u=n.top+s.element.outerHeight()+r,f=n.top-r;i+t(window).height()<u&&f>i&&s.pillbox.addClass("dropup")});s.element.find(".selections").on("wheel",et);s.element.find(".options").on("wheel",et);s.element.find(".options").on("mouseover","li",at).on("click","li",s.onOptionClick);s.element.find(".selected-options").on("click",".btn>a.remover",st)},{selectAll:s.selectAll,deselectAll:s.deselectAll,init:s.init,option:s.option,availableOptions:s.availableOptions,optionValues:s.optionValues,selectedOptions:s.selectedOptions}}var a=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""," ","","","","","","","","","","","","","","","","0","1","2","3","4","5","6","7","8","9","","","","","","","","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","","","","","","0","1","2","3","4","5","6","7","8","9","*","+","","-",".","/","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",";","=",",","-",".","/","`","","","","","","","","","","","","","","","","","","","","","","","","","","","[","\\","]",'"',"","","","","","","","","","","","","","","","","","","","","","","","","",")","!","@","#","$","%","^","&","*","(","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",":","+","<","_",">","?","~","","","","","","","","","","","","","","","","","","","","","","","","","","","{","|","}",'"'],f,o,s,c,l;if($elem=t(u.element),f=r.optionTemplate,o=r.optionsText!==undefined?r.optionsText:"",$elem.find(".selected-options").prepend('<li class="placeholder"><\/li>'),$elem.find(".selected-options").append('<li class="padder" >&nbsp;<span class="caret" ><\/span><\/li>'),$elem.find(".selected-options").append('<li class="dummy" ><input class="" type="text"  /><\/li>'),f){if(s="",typeof f=="function")s=f();else{if(c=t("#"+f)[0],!c)throw"Invalid template";s=t("#"+f)[0].innerHTML}$elem.find(".options>li").append(s)}else $elem.find(".options>li").append('<a><div data-bind="text:'+o+'"><\/div><\/a>');return l=new v(r,$elem,u),$elem.data("pillbox",self),l}return t.fn.selectRange=function(n,t){return t||(t=n),this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(n,t);else if(this.createTextRange){var i=this.createTextRange();i.collapse(!0);i.moveEnd("character",t);i.moveStart("character",n);i.select()}})},{createViewModel:r}});
//# sourceMappingURL=pillbox.min.js.map
