/*!
 * bootstrap-ko-pillbox v0.0.1 for Bootstrap 3
 * Copyright 2015 Leo Davidson
 * Licensed under http://opensource.org/licenses/MIT
 *
 * https://github.com/ltdavids/bootstrap-ko-pillbox
 */
/*! https://mths.be/startswith v0.2.0 by @mathias */
String.prototype.startsWith||function(){"use strict";var n=function(){try{var n={},t=Object.defineProperty,i=t(n,n,n)&&t}catch(r){}return i}(),i={}.toString,t=function(n){var u,f,r;if(this==null)throw TypeError();if(u=String(this),n&&i.call(n)=="[object RegExp]")throw TypeError();var e=u.length,o=String(n),s=o.length,h=arguments.length>1?arguments[1]:undefined,t=h?Number(h):0;if(t!=t&&(t=0),f=Math.min(Math.max(t,0),e),s+f>e)return!1;for(r=-1;++r<s;)if(u.charCodeAt(f+r)!=o.charCodeAt(r))return!1;return!0};n?n(String.prototype,"startsWith",{value:t,configurable:!0,writable:!0}):String.prototype.startsWith=t}();define(["knockout","jquery"],function(n,t){function r(r,u){function e(n){n||(n=window.event);n.stopPropagation?n.stopPropagation():n.cancelBubble=!0}function h(n){if(n.value.length==0)return 0;if(n.selectionStart)return n.selectionStart;if(!document.selection)return 0;var i="\001",t=document.selection.createRange(),r=t.duplicate(),u=0;return r.moveToElementText(n),t.text=i,u=r.text.indexOf(i),t.moveStart("character",-1),t.text="",u}function v(r,u,f){function l(){return o.element.attr("disabled")!==undefined}function p(){if(o.pillboxRows()&&o.selectedOptions().length>0){var n=o.element.find(".btn").height()+6,t=o.pillboxRows()*n;o.element.find(".selections").css("max-height",t.toFixed(0)+"px")}else o.element.find(".selections").css("max-height","")}function w(){o.dropdownRows()?o.element.find(".options").css("max-height",o.dropdownRows()*o.itemHeight()-4+"px"):o.element.find(".options").css("max-height","")}function tt(){window.setTimeout(function(){o.showPillbox()&&o.multiple()?(o.element.find("li.selected-option").show(),p()):(o.element.find(".selected-options").css("visibility","visible"),o.element.find("li.selected-option").hide())},0)}function b(){var n=o.placeHolder()?o.placeHolder():"Choose";o.multiple()?o.placeHolder()&&$elem.find(".selected-options li.placeholder").text(o.placeHolder()?o.placeHolder():"Choose"):$elem.find(".selected-options li.placeholder").text(o.selectedOptions().length>0?o.selectedOptions()[0][s]:n)}function v(){b();tt();o.selectedOptions().length!=0&&o.showPillbox()?o.multiple()&&(o.element.find(".selected-options li.placeholder").hide(),o.element.find(".selected-options li.padder .caret").hide()):(o.element.find(".selected-options li.placeholder").show(),o.element.find(".selected-options li.padder .caret").show());return}function k(n){var u,s,r,e,l,f;if(o.cancelKey=!1,n.keyCode==40)return o.inKeyBoardMode=!0,o.highlightNextItem(),!1;if(n.keyCode==38)return o.highlightPrevItem(),o.cancelKey=!0,!1;if(n.keyCode==34)return!1;if(u=window.shiftKey?256:0,s=a[u+n.keyCode],o.caret(h(n.target)),r=o.caret(),o.hasSearchResults())if(n.which==13||n.which==9)o.selectItem(o.options()[0]),o.clearAll(),o.cancelKey=!0;else{if(n.which==27)return o.clearAll(),c();if(n.which==8){if(e=t(o.input).val().substring(0,r-1).toUpperCase(),!e)return o.clearAll(),!1;e===o.searchText().substring(0,r-1).toUpperCase()&&(o.cancelKey=!0,t(o.input).selectRange(r-1),o.caret(r-1))}else 24<=n.which&&n.which<=222&&(l=t(o.input).val().substring(r,r+1).toUpperCase(),f=s,u+n.which>=65&&u+n.which<=90&&(f=f.toUpperCase()),f===l&&(t(o.input).selectRange(r+1),o.cancelKey=!0))}else{if(n.which==27){o.clearAll();c();return}if(n.which==9||n.which==13){t.each(o.options(),function(n,t){if(t.highlight())return o.selectItem(t),!1});o.clearAll();c();return}if(n.which==32&&o.inKeyBoardMode)for(i=0;i<o.options().length;i++)if(o.options()[i].highlight()){o.selectItem(o.options()[i]);o.cancelKey=!0;break}}if(o.cancelKey)return!1}function d(){if(o.cancelKey)return!1}function g(n){if(o.suppressKeyUp)o.suppressKeyUp=!1;else{var t=h(n.target);o.caret(t);o.filter()}}function nt(){if(!o.pillbox.hasClass("open"))return o.toggle.trigger("focus"),o.toggle.trigger("click")}function c(){if(o.pillbox.hasClass("open"))return o.toggle.trigger("focus"),o.toggle.trigger("click")}function y(n){if(o.cancelKey=!1,n.keyCode==40)return nt(),o.inKeyBoardMode=!0,o.highlightNextItem(),!1;if(n.keyCode==38)return o.highlightPrevItem(),o.cancelKey=!0,!1;if(n.which==32&&o.inKeyBoardMode){for(i=0;i<o.options().length;i++)if(o.options()[i].highlight()){o.selectItem(o.options()[i]);o.cancelKey=!0;break}}else n.which==27&&(o.clearAll(),c());n.which==9&&(o.clearAll(),c())}function it(){o.element.addClass("focus");o.element.find(".selections").addClass("focus")}function rt(){o.element.removeClass("focus");o.element.find(".selections").removeClass("focus");o.element.find(".dummy>input").show()}var o=this;return o.id=u[0].id,o.element=u,o.toggle=o.element.find(".dropdown-toggle"),o.typeAhead=n.observable(),o.cancelKey=!1,o.suppressKeyUp=!1,o.inKeyBoardMode=!1,o.pillbox=o.element.find(".pillbox"),o.typeAhead(r.typeAhead!==undefined?r.typeAhead:!1),o.optionTemplate=r.optionTemplate,o.placeHolder=n.observable(),o.dropdownRows=n.observable(),o.showPillbox=n.observable(),o.pillboxRows=n.observable(),o.multiple=n.observable(),o.autoClose=n.observable(),o.optionsText=r.optionsText!==undefined?r.optionsText:"",o.popover=n.observable(r.popover!==undefined?r.popover:""),o.selectedOptions=r.selectedOptions?r.selectedOptions:n.observableArray(),o.remainingOptions=n.observableArray(),o.caret=n.observable(0),o.showSelected=n.observable(0),o.selStart=-1,o.showSelected=r.showSelected!==undefined?r.showSelected:!1,o.scrollbar=n.observable(),o.scrollbar.subscribe(function(){o.scrollbar()?(o.element.find(".options").addClass("no-scroll"),o.element.find(".selections").addClass("no-scroll")):(o.element.find(".options").removeClass("no-scroll"),o.element.find(".selections").removeClass("no-scroll"))}),o.searchText=function(){if(o.input)return t(o.input).val().substring(0,o.caret()).toUpperCase()},o.hintText=n.observable(""),o.displayText=n.observable(""),o.options=n.observableArray(n.unwrap(o.remainingOptions).slice(0)),o.options.sort(function(n,t){return n[o.optionsText]<t[o.optionsText]?-1:n[o.optionsText]>t[o.optionsText]?1:0}),o.filtering=!1,o.lastSingle="",o.itemHeight=n.observable(12),o.hasSearchResults=function(){return o.options().length<o.remainingOptions().length&&o.options().length>0},o.placeHolderVisible=n.computed(function(){return console.debug("placeHolderVisible "+o.selectedOptions().length==0||!o.showPillbox()&&o.multiple()),o.selectedOptions().length==0||!o.showPillbox()&&o.multiple()}),o.placeHolder.subscribe(b),o.selectedOptions.subscribe(v),o.showPillbox.subscribe(v),o.itemHeight.subscribe(w),o.pillboxRows.subscribe(p),o.dropdownRows.subscribe(w),o.popoverContent=function(){var n,i;if(o.popover()&&o.popover().template)if(n="",typeof o.popover().template=="function")n=o.popover().template();else{if(i=t("#"+o.popover().template)[0],!i)throw"Invalid template";n=t("#"+o.popover().template)[0].innerHTML}return n},o.resetPopovers=function(){if($items=o.element.find(".options li"),$items.popover("hide"),o.popover()){var n=t(window).width()>400?"right auto":"bottom auto";$items.popover({html:!0,placement:n,content:o.popoverContent()})}},o.option=function(n,t){switch(n.toUpperCase()){case"PILLBOXROWS":o.pillboxRows(parseInt(t));break;case"DROPDOWNROWS":o.dropdownRows(parseInt(t));break;case"PLACEHOLDER":return t!==undefined&&o.placeHolder(t),o.placeHolder();case"TYPEAHEAD":return t!==undefined&&o.typeAhead(t),o.typeAhead();case"SCROLLBAR":return t!==undefined&&o.scrollbar(t),o.scrollbar();case"SHOWSELECTED":return t!==undefined&&(o.showSelected=t,o.filter()),o.showSelected;case"SHOWPILLBOX":return t!==undefined&&o.showPillbox(t),o.showPillbox();case"MULTIPLE":return t!==undefined&&(o.multiple(t),o.clearSelections(),v()),o.multiple();case"AUTOCLOSE":return t!==undefined&&o.autoClose(t),o.autoClose();case"DISABLED":return t!==undefined&&(t?(o.element.attr("disabled","disabled"),o.element.find(".dummy>input").hide()):t===!1&&(o.element.removeAttr("disabled"),o.element.find(".dummy>input").show())),l();case"POPOVER":t?(o.popover(t),o.element.find(".options li").popover({html:!0,placement:"right auto",content:o.popoverContent()})):(o.element.find(".options li").popover("destroy"),o.popover(t))}},o.typeAhead.subscribe(function(n){if(n&&!(o.element.find(".dropdown-menu").find(".search").length>0)){o.element.find(".dropdown-menu").prepend('<li class="search"><input class="form-control" type="text"  /><\/li>');o.input=o.element.find(".search>input")[0];o.element.find(".search>input").on("keydown",k).on("keypress",d).on("keyup",g).on("click",function(n){e(n)})}}),o.sort=function(n){n.sort(function(n,t){return n[o.optionsText]<t[o.optionsText]?-1:n[o.optionsText]>t[o.optionsText]?1:0})},o.removeItem=function(t,i){if(!l()){var i=i?i:n.dataFor(t.target);i.selected(!1);o.selectedOptions.remove(i);o.showSelected||o.remainingOptions.push(i);o.clearAll()}e(t)},o.selectItem=function(n){n.selected()||(o.multiple()||(o.clearSelections(),o.element.find(".selected-options").css("visibility","hidden")),n.selected(!0),o.showSelected||o.options.remove(n),o.selectedOptions.push(n),o.autoClose()&&!o.multiple()&&c())},o.handleClick=function(t){var i=n.dataFor(t.target);o.showPopOver(i,t);i.selected()?o.removeItem(t,i):o.selectItem(i,t);e(t)},o.filter=function(){var n,i,r;if(!o.typeAhead()){o.options(o.remainingOptions());o.options.valueHasMutated();o.options.notifySubscribers();return}(n=o.remainingOptions(),o.filtering)||(i=o.searchText(),i&&(n=o.remainingOptions().filter(function(n){return n[o.optionsText].toUpperCase().startsWith(i.toUpperCase())}),n.length<o.remainingOptions().length&&n.length>0?(o.hintText(n[0][o.optionsText].substring(o.searchText().length)),o.lastSingle!==n[0]&&(o.lastSingle=n[0],o.filtering=!0,t(o.input).val(n[0][o.optionsText]),t(o.input).selectRange(i.length),o.filtering=!1)):o.lastSingle&&(r=0,o.lastSingle="",o.clearHintText())),o.sort(n),o.options(n),o.options.valueHasMutated(),o.options.notifySubscribers(),o.resetPopovers())},o.clearSelections=function(){o.options.removeAll();o.remainingOptions(n.unwrap(r.optionValues).slice(0).map(function(t){return t.selected=n.observable(!1),t.highlight=n.observable(!1),t}));o.remainingOptions.sort(function(n,t){return n[o.optionsText]<t[o.optionsText]?-1:n[o.optionsText]>t[o.optionsText]?1:0});o.selectedOptions.removeAll();o.filter();o.resetPopovers()},o.clearSelections(),o.clearHintText=function(){o.hintText("");var n=h(o.input),i=t(o.input).val().substring(0,n);t(o.input).val(i)},o.clearHighlights=function(){t.each(o.options(),function(n,t){t.highlight(!1)})},o.highlightNextItem=function(){var n=0;for(i=0;i<o.options().length;i++)if(o.options()[i].highlight()){o.options()[i].highlight(!1);n=i+1;break}n=n>o.options().length-1?0:n;o.options()[n].highlight(!0);o.scrollTo()},o.highlightPrevItem=function(){var n=o.options().length-1;for(i=o.options().length-1;i>=0;i--)if(o.options()[i].highlight()){o.options()[i].highlight(!1);n=i-1;break}n=n<0?o.options().length-1:n;o.options()[n].highlight(!0);o.scrollTo()},o.scrollTo=function(){window.setTimeout(function(){$e=o.element.find(".highlight");$c=o.element.find(".options");var n,e=$e.offset(),s=$c.offset(),t=$c.scrollTop(),i=s.top-t,r=e.top-t,u=r+$e.height(),f=i+$c.height();u>f?n=t+u-f:r<i&&(n=t+r-i);n!==undefined&&$c.animate({scrollTop:n},100)})},o.clearAll=function(){o.hintText("");t(o.input).val("");o.caret(0);o.filter()},o.showPopOver=function(i,r){if(!o.popover())return!1;if($e=t(r.target).closest("li"),!($e.next("div.popover").length>0)){o.element.find(".options li").not($e).popover("hide");$e.popover("show");var u=$e.next("div.popover")[0];n.dataFor(u)===i&&n.cleanNode(u);n.dataFor(u)===i||n.applyBindings(i,$e.next()[0]);o.optionsPopOver}},o.hoverItem=function(t){var i=n.dataFor(t.target);o.clearHighlights();i.highlight(!0);o.showPopOver(i,t);e(t)},o.onMouseWheel=function(n){var r,u,f,e,i;if($e=t(n.target),$p=$e.parents(".options"),$p=$p.length>0?$p:$e.parents(".selections"),$p=$p.length>0?$p:$e,r=$p.hasClass("options"),(o.dropdownRows()||!r)&&(o.pillboxRows()||r))return t(n.target).closest(".popover").length>0?!1:(u=r?o.optionTemplate?30:20:10,!r)?(f=o.element.find(".btn").height()+6,$p.scrollTop($p.scrollTop()+(n.originalEvent.deltaY>0?f:f*-1)),!1):($c=o.element.find(".options"),e=0,i=0,t(".options>li").each(function(n,i){e+=t(i).outerHeight()}),n.originalEvent.deltaY<0?(i=$c.scrollTop()-u,i=Math.max(i,0)):(i=$c.scrollTop()+u,i=Math.min(i,e-$c.height())),$c.scrollTop(i),!1)},o.selectAll=function(){for(i=o.options().length-1;i>=0;i--)o.selectItem(o.options()[i])},o.deselectAll=function(){o.clearSelections()},o.init=function(){var n,i;if(o.element.data("pillbox",o),o.pillboxRows(r.pillboxRows),o.placeHolder(r.placeHolder?r.placeHolder:"Choose"),n=f.templateNodes[0],n&&(i=t.trim(n.nodeValue),o.placeHolder(i?i:o.placeHolder())),o.dropdownRows(r.dropdownRows),o.scrollbar(r.scrollbar!==undefined?r.scrollbar:!1),o.multiple(r.multiple!==undefined?r.multiple:!1),o.autoClose(r.autoClose!==undefined?r.autoClose:!1),o.showPillbox(r.showPillbox!==undefined?r.showPillbox:!0),o.typeAhead()){o.element.find(".dropdown-menu").prepend('<li class="search"><input class="form-control" type="text"  /><\/li>');o.input=o.element.find(".search>input")[0];o.element.find(".search>input").on("keydown",k).on("keypress",d).on("keyup",g).on("click",function(n){e(n)})}o.resetPopovers();o.element.find(".dummy>input").on("focus",function(){it();t("body").off("keydown",y);t("body").on("keydown",y)}).on("blur",function(){rt();t("body").off("keydown",y)});o.toggle.on("click",function(){o.element.find(".dummy>input").focus()});o.toggle.parent().on("hide.bs.dropdown",function(){o.element.find(".options li").popover("hide");o.pillbox.removeClass("dropup");o.clearAll();o.clearHighlights();o.inKeyBoardMode=!1;o.selStart=-1;o.element.find(".dummy>input").focus()});o.toggle.parent().on("shown.bs.dropdown",function(n){var i=t(o.element.find(".options li")[0]).outerHeight();o.itemHeight(i);o.dropdownRows()&&(o.itemHeight.valueHasMutated(),o.itemHeight.notifySubscribers());o.clearHighlights();$e=t(n.target);o.typeAhead()&&$e.find(".search>input")[0].focus()});o.toggle.parent().on("show.bs.dropdown",function(){if(l())return!1;o.element.find(".options").scrollTop(0);o.pillbox.removeClass("dropup");var n=o.element.offset(),i=t(window).scrollTop(),r=o.element.find(".dropdown-menu").outerHeight(),u=n.top+o.element.outerHeight()+r,f=n.top-r;i+t(window).height()<u&&f>i&&o.pillbox.addClass("dropup")});o.element.find(".selections").on("wheel",o.onMouseWheel);o.element.find(".options").on("wheel",o.onMouseWheel);o.element.find(".options").on("mouseover","li",o.hoverItem).on("click","li",o.handleClick);o.element.find(".selected-options").on("click",".btn>a.remover",o.removeItem)},{selectAll:o.selectAll,deselectAll:o.deselectAll,init:o.init,option:o.option,options:o.options,selectedOptions:o.selectedOptions}}var a=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""," ","","","","","","","","","","","","","","","","0","1","2","3","4","5","6","7","8","9","","","","","","","","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","","","","","","0","1","2","3","4","5","6","7","8","9","*","+","","-",".","/","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",";","=",",","-",".","/","`","","","","","","","","","","","","","","","","","","","","","","","","","","","[","\\","]",'"',"","","","","","","","","","","","","","","","","","","","","","","","","",")","!","@","#","$","%","^","&","*","(","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",":","+","<","_",">","?","~","","","","","","","","","","","","","","","","","","","","","","","","","","","{","|","}",'"'],f,s,o,c,l;if($elem=t(u.element),f=r.optionTemplate,s=r.optionsText!==undefined?r.optionsText:"",$elem.find(".selected-options").prepend('<li class="placeholder"><\/li>'),$elem.find(".selected-options").append('<li class="padder" >&nbsp;<span class="caret" ><\/span><\/li>'),$elem.find(".selected-options").append('<li class="dummy" ><input class="" type="text"  /><\/li>'),f){if(o="",typeof f=="function")o=f();else{if(c=t("#"+f)[0],!c)throw"Invalid template";o=t("#"+f)[0].innerHTML}$elem.find(".options>li").append(o)}else $elem.find(".options>li").append('<a><div data-bind="text:'+s+'"><\/div><\/a>');return l=new v(r,$elem,u),$elem.data("pillbox",self),l}return t.fn.selectRange=function(n,t){return t||(t=n),this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(n,t);else if(this.createTextRange){var i=this.createTextRange();i.collapse(!0);i.moveEnd("character",t);i.moveStart("character",n);i.select()}})},{createViewModel:r}});
//# sourceMappingURL=pillbox.min.js.map
