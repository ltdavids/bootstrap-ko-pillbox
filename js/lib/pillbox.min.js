/*!
 * bootstrap-ko-pillbox v0.0.1 for Bootstrap 3
 * Copyright 2015 Leo Davidson
 * Licensed under http://opensource.org/licenses/MIT
 *
 * https://github.com/ltdavids/bootstrap-ko-pillbox
 */
/*! https://mths.be/startswith v0.2.0 by @mathias */
String.prototype.startsWith||function(){"use strict";var n=function(){try{var n={},t=Object.defineProperty,i=t(n,n,n)&&t}catch(r){}return i}(),i={}.toString,t=function(n){var u,f,r;if(this==null)throw TypeError();if(u=String(this),n&&i.call(n)=="[object RegExp]")throw TypeError();var e=u.length,o=String(n),s=o.length,h=arguments.length>1?arguments[1]:undefined,t=h?Number(h):0;if(t!=t&&(t=0),f=Math.min(Math.max(t,0),e),s+f>e)return!1;for(r=-1;++r<s;)if(u.charCodeAt(f+r)!=o.charCodeAt(r))return!1;return!0};n?n(String.prototype,"startsWith",{value:t,configurable:!0,writable:!0}):String.prototype.startsWith=t}();define(["knockout","jquery"],function(n,t){function r(r,u){function e(n){n||(n=window.event);n.stopPropagation?n.stopPropagation():n.cancelBubble=!0}function h(n){if(n.value.length==0)return 0;if(n.selectionStart)return n.selectionStart;if(!document.selection)return 0;var i="\001",t=document.selection.createRange(),r=t.duplicate(),u=0;return r.moveToElementText(n),t.text=i,u=r.text.indexOf(i),t.moveStart("character",-1),t.text="",u}function p(r,u){function c(n){var u,c,r,s,l,e;if(f.cancelKey=!1,n.keyCode==40)return f.inKeyBoardMode=!0,f.highlightNextItem(),!1;if(n.keyCode==38)return f.highlightPrevItem(),f.cancelKey=!0,!1;if(n.keyCode==34)return!1;if(u=window.shiftKey?256:0,c=y[u+n.keyCode],f.caret(h(n.target)),r=f.caret(),f.options().length==1)if(n.which==13||n.which==9)f.clearAll(),f.selectItem(f.options()[0]),f.cancelKey=!0;else{if(n.which==27)return f.clearAll(),o();if(n.which==8){if(s=t(f.input).val().substring(0,r-1).toUpperCase(),!s)return f.clearAll(),!1;s===f.searchText().substring(0,r-1).toUpperCase()&&(f.cancelKey=!0,t(f.input).selectRange(r-1),f.caret(r-1))}else 24<=n.which&&n.which<=222&&(l=t(f.input).val().substring(r,r+1).toUpperCase(),e=c,u+n.which>=65&&u+n.which<=90&&(e=e.toUpperCase()),e===l&&(t(f.input).selectRange(r+1),f.cancelKey=!0))}else{if(n.which==27){f.clearAll();o();return}if(n.which==9||n.which==13){t.each(f.options(),function(n,t){if(t.highlight())return f.selectItem(t),!1});f.clearAll();o();return}if(n.which==32&&f.inKeyBoardMode)for(i=0;i<f.options().length;i++)if(f.options()[i].highlight()){f.selectItem(f.options()[i]);f.cancelKey=!0;break}}if(f.cancelKey)return!1}function l(){if(f.cancelKey)return!1}function a(n){if(f.suppressKeyUp)f.suppressKeyUp=!1;else{var t=h(n.target);f.caret(t);f.filter()}}function v(){if(!f.pillbox.hasClass("open"))return f.toggle.trigger("focus"),f.toggle.trigger("click")}function o(){if(f.pillbox.hasClass("open"))return f.toggle.trigger("focus"),f.toggle.trigger("click")}function s(n){if(f.cancelKey=!1,n.keyCode==40)return v(),f.inKeyBoardMode=!0,f.highlightNextItem(),!1;if(n.keyCode==38)return f.highlightPrevItem(),f.cancelKey=!0,!1;if(n.which==32&&f.inKeyBoardMode){for(i=0;i<f.options().length;i++)if(f.options()[i].highlight()){f.selectItem(f.options()[i]);f.cancelKey=!0;break}}else n.which==27&&(f.clearAll(),o());n.which==9&&(f.clearAll(),o())}function p(){f.inFocus(!0);f.element.addClass("focus")}function w(){f.inFocus(!1);f.element.removeClass("focus");f.element.find(".dummy>input").show()}var f=this;f.id=u[0].id;f.element=u;f.toggle=f.element.find(".dropdown-toggle");f.typeAhead=n.observable();f.cancelKey=!1;f.suppressKeyUp=!1;f.inKeyBoardMode=!1;f.pillbox=f.element.find(".pillbox");f.typeAhead(r.typeAhead!==undefined?r.typeAhead:!1);f.optionTemplate=r.optionTemplate;f.showPillbox=n.observable(r.showPillbox!==undefined?r.showPillbox:!0);f.optionsText=r.optionsText!==undefined?r.optionsText:"";f.popover=n.observable(r.popover!==undefined?r.popover:"");f.selectedOptions=r.selectedOptions?r.selectedOptions:n.observableArray();f.remainingOptions=n.observableArray();f.caret=n.observable(0);f.inFocus=n.observable(!1);f.selStart=-1;f.showSelected=r.showSelected!==undefined?r.showSelected:!1;f.scrollbar=n.observable();f.scrollbar.subscribe(function(){f.scrollbar()?f.element.find(".options").addClass("no-scroll"):f.element.find(".options").removeClass("no-scroll")});f.optionValues=r.optionValues;f.searchText=function(){if(f.input)return t(f.input).val().substring(0,f.caret()).toUpperCase()};f.hintText=n.observable("");f.displayText=n.observable("");f.options=n.observableArray(n.unwrap(f.remainingOptions).slice(0));f.options.sort(function(n,t){return n[f.optionsText]<t[f.optionsText]?-1:n[f.optionsText]>t[f.optionsText]?1:0});f.filtering=!1;f.lastSingle="";f.rows=n.observable(r.rows);f.itemHeight=n.observable(12);f.dropdownRows=n.observable(r.dropdownRows);f.height=n.computed(function(){if(f.rows()){var n=f.element.find(".btn").height()+6,t=f.rows()*n;return t.toFixed(0)+"px"}});f.dropheight=n.computed(function(){if(f.dropdownRows())return f.dropdownRows()*f.itemHeight()-4+"px"});f.popoverContent=function(){var n,i;if(f.popover()&&f.popover().template)if(n="",typeof f.popover().template=="function")n=f.popover().template();else{if(i=t("#"+f.popover().template)[0],!i)throw"Invalid template";n=t("#"+f.popover().template)[0].innerHTML}return n};f.resetPopovers=function(){if(f.element.find(".options li").popover("destroy"),f.popover()){var n=t(window).width()>400?"right auto":"bottom auto";f.element.find(".options li").popover({html:!0,placement:n,content:f.popoverContent()})}};f.option=function(n,t){switch(n.toUpperCase()){case"ROWS":f.rows(parseInt(t));break;case"DROPDOWNROWS":f.dropdownRows(parseInt(t));break;case"PLACEHOLDER":return t!==undefined&&f.placeHolder(t),f.placeHolder();case"TYPEAHEAD":return t!==undefined&&f.typeAhead(t),f.typeAhead();case"SCROLLBAR":return t!==undefined&&f.scrollbar(t),f.scrollbar();case"SHOWSELECTED":return t!==undefined&&(f.showSelected=t,f.filter()),f.showSelected;case"SHOWPILLBOX":return t!==undefined&&f.showPillbox(t),f.showPillbox();case"POPOVER":t?(f.popover(t),f.element.find(".options li").popover({html:!0,placement:"right auto",content:f.popoverContent()})):(f.element.find(".options li").popover("destroy"),f.popover(t))}};f.typeAhead.subscribe(function(n){if(n&&!(f.element.find(".dropdown-menu").find(".search").length>0)){f.element.find(".dropdown-menu").prepend('<li class="search"><input class="form-control" type="text"  /><\/li>');f.input=f.element.find(".search>input")[0];f.element.find(".search>input").on("keydown",c).on("keypress",l).on("keyup",a).on("click",function(n){e(n)})}});f.sort=function(n){n.sort(function(n,t){return n[f.optionsText]<t[f.optionsText]?-1:n[f.optionsText]>t[f.optionsText]?1:0})};f.removeItem=function(n,t){n.selected(!1);f.selectedOptions.remove(n);f.showSelected||f.remainingOptions.push(n);f.clearAll();e(t)};f.placeHolder=n.observable(r.placeHolder?r.placeHolder:"Choose");f.placeHolderVisible=n.computed(function(){return f.selectedOptions().length==0||!f.showPillbox()});f.selectItem=function(n){n.selected()||(n.selected(!0),f.showSelected||f.remainingOptions.remove(n),f.selectedOptions.push(n))};f.handleClick=function(n,t){f.showPopOver(n,t);n.selected()?f.removeItem(n,t):f.selectItem(n,t);f.clearAll();e(t)};f.filter=function(){var n,i,r;if(!f.typeAhead()){f.options(f.remainingOptions());f.options.valueHasMutated();f.options.notifySubscribers();return}(n=f.remainingOptions(),f.filtering)||(i=f.searchText(),i&&(n=f.remainingOptions().filter(function(n){return n[f.optionsText].toUpperCase().startsWith(i.toUpperCase())}),n.length==1?(f.hintText(n[0][f.optionsText].substring(f.searchText().length)),f.lastSingle!==n[0]&&(f.lastSingle=n[0],f.filtering=!0,t(f.input).val(n[0][f.optionsText]),t(f.input).selectRange(i.length),f.filtering=!1)):f.lastSingle&&(r=0,f.lastSingle="",f.clearHintText()),f.sort(n)),f.sort(n),f.options(n),f.options.valueHasMutated(),f.options.notifySubscribers())};f.clearSelections=function(){f.options.removeAll();f.remainingOptions(n.unwrap(r.optionValues).slice(0).map(function(t){return t.selected=n.observable(!1),t.highlight=n.observable(!1),t}));f.remainingOptions.sort(function(n,t){return n[f.optionsText]<t[f.optionsText]?-1:n[f.optionsText]>t[f.optionsText]?1:0});f.selectedOptions.removeAll();f.filter();f.resetPopovers()};f.clearSelections();f.clearHintText=function(){f.hintText("");var n=h(f.input),i=t(f.input).val().substring(0,n);t(f.input).val(i)};f.clearHighlights=function(){t.each(f.options(),function(n,t){t.highlight(!1)})};f.highlightNextItem=function(){var n=0;for(i=0;i<f.options().length;i++)if(f.options()[i].highlight()){f.options()[i].highlight(!1);n=i+1;break}n=n>f.options().length-1?0:n;f.options()[n].highlight(!0);f.scrollTo()};f.highlightPrevItem=function(){var n=f.options().length-1;for(i=f.options().length-1;i>=0;i--)if(f.options()[i].highlight()){f.options()[i].highlight(!1);n=i-1;break}n=n<0?f.options().length-1:n;f.options()[n].highlight(!0);f.scrollTo()};f.scrollTo=function(){window.setTimeout(function(){$e=f.element.find(".highlight");$c=f.element.find(".options");var n,o=$e.offset(),s=$c.offset(),t=$c.scrollTop(),i=s.top-t,r=o.top-t,u=r+$e.height(),e=i+$c.height();u>e?n=t+u-e:r<i&&(n=t+r-i);n!==undefined&&$c.animate({scrollTop:n},100)})};f.clearAll=function(){f.hintText("");t(f.input).val("");f.caret(0);f.filter()};f.showPopOver=function(i,r){if(!f.popover())return!1;if($e=t(r.target).closest("li"),!($e.next("div.popover").length>0)){f.element.find(".options li").not($e).popover("hide");$e.popover("show");var u=$e.next("div.popover")[0];n.dataFor(u)===i&&n.cleanNode(u);n.dataFor(u)===i||n.applyBindings(i,$e.next()[0]);f.optionsPopOver}};f.hoverItem=function(n,t){f.clearHighlights();n.highlight(!0);f.showPopOver(n,t);e(t)};f.onMouseWheel=function(n){var r,u,i;if(f.dropdownRows())return t(n.target).closest(".popover").length>0?!1:(r=f.optionTemplate?30:20,$c=f.element.find(".options"),u=0,i=0,t(".options>li").each(function(n,i){u+=t(i).outerHeight()}),n.originalEvent.deltaY<0?(i=$c.scrollTop()-r,i=Math.max(i,0)):(i=$c.scrollTop()+r,i=Math.min(i,u-$c.height())),$c.scrollTop(i),!1)};f.selectAll=function(){t.each(f.options(),function(n,t){f.selectItem(t)})};f.deselectAll=function(){f.clearSelections()};f.init=function(){if(f.element.data("pillbox",f),f.scrollbar(r.scrollbar!==undefined?r.scrollbar:!1),f.typeAhead()){f.element.find(".dropdown-menu").prepend('<li class="search"><input class="form-control" type="text"  /><\/li>');f.input=f.element.find(".search>input")[0];f.element.find(".search>input").on("keydown",c).on("keypress",l).on("keyup",a).on("click",function(n){e(n)})}f.resetPopovers();f.element.find(".dummy>input").on("focus",function(){p();t("body").off("keydown",s);t("body").on("keydown",s)}).on("blur",function(){w();t("body").off("keydown",s)});f.toggle.on("click",function(){f.element.find(".dummy>input").focus()});f.toggle.parent().on("hide.bs.dropdown",function(){f.element.find(".options li").popover("hide");f.pillbox.removeClass("dropup");f.clearAll();f.clearHighlights();f.inKeyBoardMode=!1;f.selStart=-1;f.element.find(".dummy>input").focus()});f.toggle.parent().on("shown.bs.dropdown",function(n){if(f.dropdownRows()){var i=t(f.element.find(".options li")[0]).outerHeight();f.itemHeight(i);f.itemHeight.valueHasMutated()}f.clearHighlights();$e=t(n.target);f.typeAhead()&&$e.find(".search>input")[0].focus()});f.toggle.parent().on("show.bs.dropdown",function(){if(f.element.attr("disabled"))return!1;f.element.find(".options").scrollTop(0);f.pillbox.removeClass("dropup");var n=f.element.offset(),i=t(window).scrollTop(),r=f.element.find(".dropdown-menu").outerHeight(),u=n.top+f.element.outerHeight()+r,e=n.top-r;i+t(window).height()<u&&e>i&&f.pillbox.addClass("dropup")});f.element.find(".options").on("wheel",f.onMouseWheel)}}var y=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""," ","","","","","","","","","","","","","","","","0","1","2","3","4","5","6","7","8","9","","","","","","","","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","","","","","","0","1","2","3","4","5","6","7","8","9","*","+","","-",".","/","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",";","=",",","-",".","/","`","","","","","","","","","","","","","","","","","","","","","","","","","","","[","\\","]",'"',"","","","","","","","","","","","","","","","","","","","","","","","","",")","!","@","#","$","%","^","&","*","(","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",":","+","<","_",">","?","~","","","","","","","","","","","","","","","","","","","","","","","","","","","{","|","}",'"'],f,a,o,v,s,c,l;if($elem=t(u.element),f=r.optionTemplate,a=r.optionsText!==undefined?r.optionsText:"",$elem.find(".selected-options").prepend('<li class="placeholder" data-bind="visible:placeHolderVisible"><span  data-bind="text:placeHolder"><\/span><\/li>'),$elem.find(".selected-options").append('<li class="padder" >&nbsp;<span class="caret" data-bind="visible:placeHolderVisible"><\/span><\/li>'),$elem.find(".selected-options").append('<li class="dummy" ><input class="" type="text"  /><\/li>'),f){if(o="",typeof f=="function")o=f();else{if(v=t("#"+f)[0],!v)throw"Invalid template";o=t("#"+f)[0].innerHTML}$elem.find(".options>li").append(o)}else $elem.find(".options>li").append('<a><div data-bind="text:'+a+'"><\/div><\/a>');return s=new p(r,$elem),c=u.templateNodes[0],c&&(l=t.trim(c.nodeValue),s.placeHolder(l?l:s.placeHolder())),$elem.data("pillbox",self),s}return t.fn.selectRange=function(n,t){return t||(t=n),this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(n,t);else if(this.createTextRange){var i=this.createTextRange();i.collapse(!0);i.moveEnd("character",t);i.moveStart("character",n);i.select()}})},{createViewModel:r}});
//# sourceMappingURL=pillbox.min.js.map
