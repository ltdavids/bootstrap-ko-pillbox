/*!
 * bootstrap-ko-pillbox v0.0.1 for Bootstrap 3
 * Copyright 2015 Leo Davidson
 * Licensed under http://opensource.org/licenses/MIT
 *
 * https://github.com/ltdavids/bootstrap-ko-pillbox
 */
/*! https://mths.be/startswith v0.2.0 by @mathias */
String.prototype.startsWith||function(){"use strict";var n=function(){try{var n={},t=Object.defineProperty,i=t(n,n,n)&&t}catch(r){}return i}(),i={}.toString,t=function(n){var u,f,r;if(this==null)throw TypeError();if(u=String(this),n&&i.call(n)=="[object RegExp]")throw TypeError();var e=u.length,o=String(n),s=o.length,h=arguments.length>1?arguments[1]:undefined,t=h?Number(h):0;if(t!=t&&(t=0),f=Math.min(Math.max(t,0),e),s+f>e)return!1;for(r=-1;++r<s;)if(u.charCodeAt(f+r)!=o.charCodeAt(r))return!1;return!0};n?n(String.prototype,"startsWith",{value:t,configurable:!0,writable:!0}):String.prototype.startsWith=t}();define(["knockout","jquery"],function(n,t){function r(r,u){function f(n){n||(n=window.event);n.stopPropagation?n.stopPropagation():n.cancelBubble=!0}function h(n){if(n.value.length==0)return 0;if(n.selectionStart)return n.selectionStart;if(!document.selection)return 0;var i="\001",t=document.selection.createRange(),r=t.duplicate(),u=0;return r.moveToElementText(n),t.text=i,u=r.text.indexOf(i),t.moveStart("character",-1),t.text="",u}function p(r,u){function c(n){var u,c,r,s,l,f;if(e.cancelKey=!1,n.keyCode==40)return e.inKeyBoardMode=!0,e.highlightNextItem(),!1;if(n.keyCode==38)return e.highlightPrevItem(),e.cancelKey=!0,!1;if(n.keyCode==34)return!1;if(u=window.shiftKey?256:0,c=v[u+n.keyCode],e.caret(h(n.target)),r=e.caret(),e.options().length==1)if(n.which==13||n.which==9)e.clearAll(),e.selectItem(e.options()[0]),e.cancelKey=!0;else{if(n.which==27)return e.clearAll(),o();if(n.which==8){if(s=t(e.input).val().substring(0,r-1).toUpperCase(),!s)return e.clearAll(),!1;s===e.searchText().substring(0,r-1).toUpperCase()&&(e.cancelKey=!0,t(e.input).selectRange(r-1),e.caret(r-1))}else 24<=n.which&&n.which<=222&&(l=t(e.input).val().substring(r,r+1).toUpperCase(),f=c,u+n.which>=65&&u+n.which<=90&&(f=f.toUpperCase()),f===l&&(t(e.input).selectRange(r+1),e.cancelKey=!0))}else{if(n.which==27){e.clearAll();o();return}if(n.which==9||n.which==13){t.each(e.options(),function(n,t){if(t.highlight())return e.selectItem(t),!1});e.clearAll();o();return}if(n.which==32&&e.inKeyBoardMode)for(i=0;i<e.options().length;i++)if(e.options()[i].highlight()){e.selectItem(e.options()[i]);e.cancelKey=!0;break}}if(e.cancelKey)return!1}function l(){if(e.cancelKey)return!1}function a(n){if(e.suppressKeyUp)e.suppressKeyUp=!1;else{var t=h(n.target);e.caret(t);e.filter()}}function y(){if(!e.pillbox.hasClass("open"))return e.toggle.trigger("focus"),e.toggle.trigger("click")}function o(){if(e.pillbox.hasClass("open"))return e.toggle.trigger("focus"),e.toggle.trigger("click")}function s(n){if(e.cancelKey=!1,n.keyCode==40)return y(),e.inKeyBoardMode=!0,e.highlightNextItem(),!1;if(n.keyCode==38)return e.highlightPrevItem(),e.cancelKey=!0,!1;if(n.which==32&&e.inKeyBoardMode){for(i=0;i<e.options().length;i++)if(e.options()[i].highlight()){e.selectItem(e.options()[i]);e.cancelKey=!0;break}}else n.which==27&&(e.clearAll(),o());n.which==9&&(e.clearAll(),o())}function p(){e.inFocus(!0);e.element.addClass("focus")}function w(){e.inFocus(!1);e.element.removeClass("focus");e.element.find(".dummy>input").show()}var e=this;e.id=u[0].id;e.element=u;e.toggle=e.element.find(".dropdown-toggle");e.typeAhead=n.observable();e.cancelKey=!1;e.suppressKeyUp=!1;e.inKeyBoardMode=!1;e.pillbox=e.element.find(".pillbox");e.typeAhead(r.typeAhead!==undefined?r.typeAhead:!1);e.showPillbox=n.observable(r.showPillbox!==undefined?r.showPillbox:!0);e.optionsText=r.optionsText!==undefined?r.optionsText:"";e.popover=n.observable(r.popover!==undefined?r.popover:"");e.popoverTemplate=r.popoverTemplate!==undefined?r.popoverTemplate:"";e.selectedOptions=r.selectedOptions?r.selectedOptions:n.observableArray();e.remainingOptions=n.observableArray();e.caret=n.observable(0);e.inFocus=n.observable(!1);e.selStart=-1;e.showSelected=r.showSelected!==undefined?r.showSelected:!1;e.scrollbar=n.observable(!0);e.scrollbar.subscribe(function(){e.scrollbar()?e.element.find(".options").removeClass("no-scroll"):e.element.find(".options").addClass("no-scroll")});e.optionValues=r.optionValues;e.searchText=function(){if(e.input)return t(e.input).val().substring(0,e.caret()).toUpperCase()};e.hintText=n.observable("");e.displayText=n.observable("");e.options=n.observableArray(n.unwrap(e.remainingOptions).slice(0));e.options.sort(function(n,t){return n[e.optionsText]<t[e.optionsText]?-1:n[e.optionsText]>t[e.optionsText]?1:0});e.filtering=!1;e.lastSingle="";e.rows=n.observable(r.rows);e.itemHeight=n.observable(12);e.dropdownRows=n.observable(r.dropdownRows);e.height=n.computed(function(){if(e.rows()){var n=e.element.find(".btn").height()+6,t=e.rows()*n;return t.toFixed(0)+"px"}});e.dropheight=n.computed(function(){if(e.dropdownRows())return e.dropdownRows()*e.itemHeight()-4+"px"});e.popoverContent=function(){var n,i;if(e.popover()&&e.popover().popoverTemplate)if(n="",typeof e.popover().popoverTemplate=="function")n=e.popover().popoverTemplate();else{if(i=t("#"+e.popover().popoverTemplate)[0],!i)throw"Invalid template";n=t("#"+e.popover().popoverTemplate)[0].innerHTML}return n};e.resetPopovers=function(){e.element.find(".options li").popover("destroy");e.popover()&&e.element.find(".options li").popover({html:!0,placement:"right auto",content:e.popoverContent()})};e.option=function(n,t){switch(n.toUpperCase()){case"ROWS":e.rows(parseInt(t));break;case"DROPDOWNROWS":e.dropdownRows(parseInt(t));break;case"PLACEHOLDER":return t!==undefined&&e.placeHolder(t),e.placeHolder();case"TYPEAHEAD":return t!==undefined&&e.typeAhead(t),e.typeAhead();case"SCROLLBAR":return t!==undefined&&e.scrollbar(t),e.scrollbar();case"SHOWSELECTED":return t!==undefined&&(e.showSelected=t,e.filter()),e.showSelected;case"SHOWPILLBOX":return t!==undefined&&e.showPillbox(t),e.showPillbox();case"POPOVER":t?(e.popover(t),e.element.find(".options li").popover({html:!0,placement:"right auto",content:e.popoverContent()})):(e.element.find(".options li").popover("destroy"),e.popover(t))}};e.typeAhead.subscribe(function(n){if(n&&!(e.element.find(".dropdown-menu").find(".search").length>0)){e.element.find(".dropdown-menu").prepend('<li class="search"><input class="form-control" type="text"  /><\/li>');e.input=e.element.find(".search>input")[0];e.element.find(".search>input").on("keydown",c).on("keypress",l).on("keyup",a).on("click",function(n){f(n)})}});e.sort=function(n){n.sort(function(n,t){return n[e.optionsText]<t[e.optionsText]?-1:n[e.optionsText]>t[e.optionsText]?1:0})};e.removeItem=function(n,t){n.selected(!1);e.selectedOptions.remove(n);e.showSelected||e.remainingOptions.push(n);e.clearAll();f(t)};e.placeHolder=n.observable(r.placeHolder?r.placeHolder:"Choose");e.placeHolderVisible=n.computed(function(){return e.selectedOptions().length==0||!e.showPillbox()});e.selectItem=function(n){n.selected()||(n.selected(!0),e.showSelected||e.remainingOptions.remove(n),e.selectedOptions.push(n))};e.handleClick=function(n,t){e.showPopOver(n,t);n.selected()?e.removeItem(n,t):e.selectItem(n,t);e.clearAll();f(t)};e.filter=function(){var n,i,r;if(!e.typeAhead()){e.options(e.remainingOptions());e.options.valueHasMutated();e.options.notifySubscribers();return}(n=e.remainingOptions(),e.filtering)||(i=e.searchText(),i&&(n=e.remainingOptions().filter(function(n){return n[e.optionsText].toUpperCase().startsWith(i.toUpperCase())}),n.length==1?(e.hintText(n[0][e.optionsText].substring(e.searchText().length)),e.lastSingle!==n[0]&&(e.lastSingle=n[0],e.filtering=!0,t(e.input).val(n[0][e.optionsText]),t(e.input).selectRange(i.length),e.filtering=!1)):e.lastSingle&&(r=0,e.lastSingle="",e.clearHintText()),e.sort(n)),e.sort(n),e.options(n),e.options.valueHasMutated(),e.options.notifySubscribers())};e.clearSelections=function(){e.options.removeAll();e.remainingOptions(n.unwrap(r.optionValues).slice(0).map(function(t){return t.selected=n.observable(!1),t.highlight=n.observable(!1),t}));e.remainingOptions.sort(function(n,t){return n[e.optionsText]<t[e.optionsText]?-1:n[e.optionsText]>t[e.optionsText]?1:0});e.selectedOptions.removeAll();e.filter();e.resetPopovers()};e.clearSelections();e.clearHintText=function(){e.hintText("");var n=h(e.input),i=t(e.input).val().substring(0,n);t(e.input).val(i)};e.clearHighlights=function(){t.each(e.options(),function(n,t){t.highlight(!1)})};e.highlightNextItem=function(){var n=0;for(i=0;i<e.options().length;i++)if(e.options()[i].highlight()){e.options()[i].highlight(!1);n=i+1;break}n=n>e.options().length-1?0:n;e.options()[n].highlight(!0);e.scrollTo()};e.highlightPrevItem=function(){var n=e.options().length-1;for(i=e.options().length-1;i>=0;i--)if(e.options()[i].highlight()){e.options()[i].highlight(!1);n=i-1;break}n=n<0?e.options().length-1:n;e.options()[n].highlight(!0);e.scrollTo()};e.scrollTo=function(){window.setTimeout(function(){$e=e.element.find(".highlight");$c=e.element.find(".options");var n,o=$e.offset(),s=$c.offset(),t=$c.scrollTop(),i=s.top-t,r=o.top-t,u=r+$e.height(),f=i+$c.height();u>f?n=t+u-f:r<i&&(n=t+r-i);n!==undefined&&$c.animate({scrollTop:n},100)})};e.clearAll=function(){e.hintText("");t(e.input).val("");e.caret(0);e.filter()};e.showPopOver=function(i,r){if(!e.popover())return!1;if($e=t(r.target).closest("li"),!($e.next("div.popover").length>0)){e.element.find(".options li").not($e).popover("hide");$e.popover("show");var u=$e.next("div.popover")[0];n.dataFor(u)===i&&n.cleanNode(u);n.dataFor(u)===i||n.applyBindings(i,$e.next()[0]);e.optionsPopOver}};e.hoverItem=function(n,t){e.clearHighlights();n.highlight(!0);e.showPopOver(n,t);f(t)};e.onMouseWheel=function(n){if(console.debug("onMouseWheel"),t(n.target).closest(".popover").length>0)return!1;$c=e.element.find(".options");var u=e.itemHeight(),o=u*$c.find("li").length,i=$c.scrollTop(),f=i+$c.height(),r=0;if(n.originalEvent.deltaY<0){if(i<7)return;t(".options>li").each(function(n,u){if(t(u).position().top<0&&t(u).position().top+t(u).outerHeight()>=0)return r=t(t(".options>li")[n-1]).position().top+i,!1});i=r+1}else t(".options>li").each(function(n,i){return r+=t(i).outerHeight(),r>f?!1:void 0}),i=r-$c.height();return $c.scrollTop(i),!1};e.selectAll=function(){t.each(e.options(),function(n,t){e.selectItem(t)})};e.deselectAll=function(){e.clearSelections()};e.init=function(){if(e.element.data("pillbox",e),e.scrollbar(r.scrollbar!==undefined?r.scrollbar:!1),e.typeAhead()){e.element.find(".dropdown-menu").prepend('<li class="search"><input class="form-control" type="text"  /><\/li>');e.input=e.element.find(".search>input")[0];e.element.find(".search>input").on("keydown",c).on("keypress",l).on("keyup",a).on("click",function(n){f(n)})}e.popover()&&e.element.find(".options li").popover({html:!0,placement:"right auto",content:e.popoverContent()});e.element.find(".dummy>input").on("focus",function(){p();t("body").off("keydown",s);t("body").on("keydown",s)}).on("blur",function(){w();t("body").off("keydown",s)});e.toggle.on("click",function(){e.element.find(".dummy>input").focus()});e.toggle.parent().on("hide.bs.dropdown",function(){e.element.find(".options li").popover("hide");e.pillbox.removeClass("dropup");e.clearAll();e.clearHighlights();e.inKeyBoardMode=!1;e.selStart=-1;e.element.find(".dummy>input").focus()});e.toggle.parent().on("shown.bs.dropdown",function(n){if(e.dropdownRows()){var i=t(e.element.find(".options li")[0]).outerHeight();e.itemHeight(i);e.itemHeight.valueHasMutated()}e.clearHighlights();$e=t(n.target);e.typeAhead()&&$e.find(".search>input")[0].focus()});e.toggle.parent().on("show.bs.dropdown",function(){if(e.element.attr("disabled"))return!1;e.element.find(".options").scrollTop(0);e.pillbox.removeClass("dropup");var n=e.element.offset(),i=t(window).scrollTop(),r=e.element.find(".dropdown-menu").outerHeight(),u=n.top+e.element.outerHeight()+r,f=n.top-r;i+t(window).height()<u&&f>i&&e.pillbox.addClass("dropup")});e.element.find(".options").on("wheel",e.onMouseWheel)}}var v=["","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",""," ","","","","","","","","","","","","","","","","0","1","2","3","4","5","6","7","8","9","","","","","","","","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","","","","","","0","1","2","3","4","5","6","7","8","9","*","+","","-",".","/","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",";","=",",","-",".","/","`","","","","","","","","","","","","","","","","","","","","","","","","","","","[","\\","]",'"',"","","","","","","","","","","","","","","","","","","","","","","","","",")","!","@","#","$","%","^","&","*","(","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","",":","+","<","_",">","?","~","","","","","","","","","","","","","","","","","","","","","","","","","","","{","|","}",'"'],o,a,s,c,l;$elem=t(u.element);var e=r.optionTemplate,y=r.optionsText!==undefined?r.optionsText:"",w=r.optionsPopOver!==undefined?r.optionsPopOver:"";if($elem.find(".selected-options").prepend('<li class="placeholder" data-bind="visible:placeHolderVisible"><span  data-bind="text:placeHolder"><\/span><\/li>'),$elem.find(".selected-options").append('<li class="padder" >&nbsp;<span class="caret" data-bind="visible:placeHolderVisible"><\/span><\/li>'),$elem.find(".selected-options").append('<li class="dummy" ><input class="" type="text"  /><\/li>'),e){if(o="",typeof e=="function")o=e();else{if(a=t("#"+e)[0],!a)throw"Invalid template";o=t("#"+e)[0].innerHTML}$elem.find(".options>li").append(o)}else $elem.find(".options>li").append('<a><div data-bind="text:'+y+'"><\/div><\/a>');return s=new p(r,$elem),c=u.templateNodes[0],c&&(l=t.trim(c.nodeValue),s.placeHolder(l?l:s.placeHolder())),$elem.data("pillbox",self),s}return t.fn.selectRange=function(n,t){return t||(t=n),this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(n,t);else if(this.createTextRange){var i=this.createTextRange();i.collapse(!0);i.moveEnd("character",t);i.moveStart("character",n);i.select()}})},{createViewModel:r}});
//# sourceMappingURL=pillbox.min.js.map
